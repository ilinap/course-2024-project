# Курсовой проект: ИС бронирования авиабилетов

**Содержание:**

## Словарь сокращений

ИС - Информационная Система

ПО - Программное Обеспечение

БД - База Данных

DAU - Daily Active Users

MVP - Minimum Viable Product

KPI - Key Performance Indicators

## О**писание исходных данных**

Существующие сервисы по бронированию билетов перестают быть просто платформой для покупки билетов. И хотя на рынке уже присутствуют сервисы, которые помогают узнать дополнительную информацию о месте назначения (Например, АviaSales), эти платформы до сих пор не предоставляют полной актуальной информации и ряда услуг, которые могли бы быть полезны, например, для лиц, подверженных серьезным аллергическим реакциям. Помимо этого, через сервис бронирования билетов пользователи заблаговременно могли бы узнавать самую важную и свежую информацию, которая помогла бы им легко и  быстро планировать свое путешествие.

В связи с этим хочу предложить новую онлайн платформу для бронирования билетов, которая не только сможет обеспечить комфортный перелет, но и поможет наилучшим образом спланировать время пребывания в пункте назначения, за счет агрегации необходимой информации в одном месте.  

## Бизнес-цели и критерии успеха

От внедрения предлагаемого решения ожидаются следующие результаты:

1. За полгода увеличить количество людей, довольных сервисом на борту, на 20%
2. За полгода уменьшить число возвращений билетов на 15%
3. За полгода увеличить количество бронирований билетов в мобильном приложении на 10% благодаря улучшению информативности подбора направлений билетов

Ниже перечислены критерии, по которым будет понятно, что решение реализовано успешно:

1. Увеличился time-spent на 10% через месяц после запуска проекта
2. Увеличился DAU на 15% через два месяца после запуска проекта
3. Retention за месячный период после запуска проекта увеличился на 5%
4. Увеличилось количество пользователей, использующих сервисы партнеров, на 500 за месяц после запуска проекта
5. Увеличилось количество положительных отзывов от пользователей на 20% после запуска проекта

## Общее описание концепции и основных функций продукта

Данная платформа будет предоставлять возможность бронирования билетов, а также ряд дополнительных услуг, которые будут полезны при планировании путешествия. 

Для успешной реализации проекта были определены и описаны основные функции продукта, а также объемы выпускаемых версий, которые не только будут обладать достаточным для пользования функционалом, но и позволят развививать приложение и делать его уникальным: (желтым показаны обобщенно функции, а зеленым - более детализировано) 

![Untitled](%D0%9A%D1%83%D1%80%D1%81%D0%BE%D0%B2%D0%BE%D0%B8%CC%86%20%D0%BF%D1%80%D0%BE%D0%B5%D0%BA%D1%82%20%D0%98%D0%A1%20%D0%B1%D1%80%D0%BE%D0%BD%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F%20%D0%B0%D0%B2%D0%B8%D0%B0%D0%B1%D0%B8%D0%BB%D0%B5%D1%82%D0%BE%D0%B2%200889de6c4a304239850b39295292ae5e/Untitled.png)

## Описание предположений, допущений и рисков

В процессе определения зависимостей данной ИС, ее целей и задач на старте проекта были определены следующие предположения и допущения:

1. Мы допускаем что 20% пользователей будут пользоваться нашим ресурсом только в целях ознакомления и получения необходимой информации
2. Мы предполагаем, что 40% нашей целевой аудитории будет пользоваться мобильным приложением сервиса
3. Мы допускаем, что около половины наших пользователей могут быть лица, не знающие русского языка

Для проектирования более надежной архитектуры ИС также был предусмотрен ряд рисков, которые могут не позволить достичь поставленных целей:

1. Блокирование API сервиса предоставления билетов или изменение ее модели данных 
2. Блокирование API сервисов, которые предоставляли дополнительную информацию для нашей платформы (погода, сезоны цветения растений-аллергенов)
3. Пандемия
4. Закрытие границ
5. Подорожание билетов

## Ограничения и исключения

В целях сохранения уникальности продукта было решено, что ИС не будет:

1. предоставлять информацию о точках питания
2. предоставлять информацию о достопримечательностях и о точном их местоположении
3. взаимодействовать с системами аэропорта (предоставление парковки, fast track, бизнес-зала)

## Этапы выполнения проекта

Каждый пункт подразумевает под собой отдельный этап, который длится около 1 недели. Таким образом, время реализации проекта составляет 12 недель.

Ниже представлен план выполнения проекта по этапам:

**Анализ:**

1. Сбор требований и проведение анализа конкурентов
2. Определение целей и задач
3. Определение ограничений и рисков; ресурсов и средств

**Проектирование:**

1. Проектирование модели БД
2. Разработка спецификации требований ПО
3. Определение KPI

**Разработка и тестирование:**

1. Развертывание инфраструктуры и разработка кода системы
2. Тестирование системы, документирование ошибок и исправление
3. Оценка выполнения всех желаемых требований

**Релиз:**

1. Выполнить устранение недостатков
2. Наладить и задокументировать критически важные процессы

**Поддержка и обслуживание:**

1. Сопровождение и обновление

## Требования к ИС

Для MVP были определены и описаны функциональные и нефункциональные требования.

### Функциональные требования

- Сценарий: Сбор маршрутов
    
    Цель: Собрать все возможные маршруты, которыми может воспользоваться пользователь, чтобы добраться до нужной точки
    
    Участники:
    
    - Потенциальный пассажир (пользователь)
    - Система сбора маршрутов (система)
    
    Предусловие: Система работает штатно
    
    Основной сценарий:
    
    1) Пользователь в поисковых строках указывает точки вылета—прилета и даты
    
    2) Система проверяет существование рейсов указанных городов 
    
    3) Пользователь нажимает на значок «Поиск» 
    
    4) Система обращается ко всем сервисам авиакомпаний, к которым у нее есть доступ, и из всей собранной базы составляет возможные маршруты с учетом места вылета, прилета и даты и выдает список всех вариантов пользователю
    
    5) Пользователь нажимает на значок «Отфильтровать» 
    
    6) Система выдает список возможных способов сортировки списка маршрутов
    
    7) Пользователь нажимает на интересуемый способ сортировки
    
    8) Система выдает отсортированный список маршрутов 
    
- Сценарий: Отображение информации о необходимости приобретения визы
    
    Цель: Оповестить пользователя о необходимости приобрести визу в указанную страну
    
    Участники:
    
    - Потенциальный пассажир (пользователь)
    - Система сбора информации о визах (система)
    
    Предусловие: Система работает штатно
    
    Основной сценарий:
    
    1) Пользователь нажимает на понравившийся маршрут
    
    2) Система обращается к визовой базе данных и указывает в деталях к маршруту «(Не-)Требуется виза» в указанную страну
    
    Предусловие: Система выдала «Требуется виза»
    
    3) Пользователь нажимает на кнопку «Подробнее»
    
    4) Система отображает пользователю условия и актуальную информацию, касаемую приобретения виз в данную страну 
    
- Сценарий: Оплата билетов
    
    Цель: Помочь пользователю быстро и легко произвести оплату билетов через сбп
    
    Участники:
    
    - Будущий пассажир (пользователь)
    - Система оплаты (система)
    
    Предусловие: Система работает штатно, пользователь выбрал рейс и ввел паспортные данные, места есть, у пользователя есть приложение банка 
    
    Основной сценарий:
    
    1) Пользователь нажимает на кнопку «Оплатить билеты»
    
    2) Система открывает новое окно с выбором банка для оплаты сбп
    
    а. Предусловие: Пользователь бронирует билет в мобильном приложении 
    
    3) Пользователь нажимает на желаемый банк
    
    4) Система открывает приложение выбранного банка
    
    5) Пользователь подтверждает аутентификацию через биометрию или пароль и производит оплату забронированных билетов
    
    б. Предусловие: Бронирование билетов производится через браузер
    
    3) Пользователь нажимает на кнопку «Получить QR-код»
    
    4) Система откроет сгенерированный QR-код
    
    5) Пользователь наведет сканер из приложения банка на телефоне и произведет оплату через сбп
    
    Предусловие: у пользователя было достаточно средств на данном счете 
    
    6) Система получает уведомление об оплате, отображает успешность покупки пользователю и передает информацию на сервис авиакомпании об окончательном закреплении места за пользователем
    
- Сценарий: Сбор информации о погоде в месте назначения
    
    Цель: Проинформировать пользователя о погодных условиях в выбранном месте в определенные даты и таким образом, помочь скорректировать даты 
    
    Участники:
    
    - Потенциальный пассажир (пользователь)
    - Система сбора информации о погоде
    
    Предусловие: Система работает штатно, пользователь выбрал маршрут и даты
    
    Основной сценарий:
    
    1) Пользователь нажимает на кнопку «Поиск»
    
    2) Система обращается к серверу погоды и сбоку от списка рейсов система выдает погодные условия в месте назначения на выбранные даты
    
    3) Пользователь нажимает на значок «Подробнее»
    
    4) Система обращается к сервису погоды и открывает окно с текущей погодой, прогнозируемой погодой на выбранные даты, а также на неделю до и после выбранных дат
    
- Сценарий: Бронирование билетов
    
    Цель: закрепить место за пользователем на определенный промежуток времени и таким образом, дать ему время подумать, на сколько подходит выбранный рейс
    
    Участники:
    
    - Потенциальный пассажир (пользователь)
    - Система бронирования (система)
    
    Предусловие: Система работает штатно, пользователь выбрал рейс и ввел паспортные данные
    
    Основной сценарий:
    
    1) Пользователь нажимает на кнопку «Оплатить билеты»
    
    2) Система проверяет корректность введенных данных и обращается к серверу авиакомпании, чтобы ВРЕМЕННО закрепить билеты за пользователем
    
    Предусловие: пользователь не произвел оплату за 30 минут до истечения времени брони
    
    3) Система присылает уведомление в личный кабинет пользователя с оповещением об истечении времени брони
    
    4) Пользователь нажимает на кнопку «Прочитано»
    
    5) Если пользователь не нажал на кнопку «Прочитано» или он еще не зарегистрировался, тогда система за 15 минут до истечения времени брони присылает оповещение на почту 
    
    6) Если в момент истечения срока брони оплата не была произведена, тогда система обращается к сервису авиакомпании и отменяет временное закрепления билетов за соответствующим пользователем
    
- Сценарий: Уведомление о предстоящих полетах
    
    Цель: Заранее оповестить пользователя о предстоящем полете
    
    Участники:
    
    - Потенциальный пассажир (пользователь)
    - Система сбора информации о полетах пользователя (система)
    
    Предусловие: Система работает штатно, пользователь оплатил билет
    
    Основной сценарий:
    
    1) Система хранит информацию о пользователе и за 4 часа до рейса система высылает оповещение о предстоящем полете 
    
    2) Пользователь нажимает на кнопку уведомления
    
    3) Система открывает детали маршрута
    
    4) Пользователь нажимает на кнопку «Выезжаю»
    
    5) Система помечает уведомление, как прочитанное
    
    6) Если пользователь не нажал на кнопку «Выезжаю», тогда система высылает письмо на почту пользователя с уведомлением о предстоящем полете и всеми необходимыми деталями
    

### Нефункциональные требования

**Требования к производительности системы:**

1) Генерация подбора одного маршрута должна осуществляться не более 0,5 секунды для половины пользователей (при учете, что количество пользователей составляет 20 000)

2) Система должна исполнять 90% типовых запросов за время не более 1 секунды

**Требования к надежности системы:**

1) Система должна допускать сбои без ущерба безопасности данных не более чем в 7% запросов

2) После сбоя система должна восстанавливать свою работу не более чем за 5 минут

**Требования к безопасности системы и ограничения:**

1) В случае ошибки при загрузке страницы ранее внесенные данные сохраняются не более чем на 30 минут, чтобы защитить конфиденциальную информацию пользователя

2) Система ограничивает количество бронируемых билетов: не больше пяти билетов на один рейс

3) Бронь билетов отменяется через 2 часа, в случае если не вносится плата за них, и через 30 минут — в случае если рейс меньше чем через 24 часа

**Требования к доступности системы:**

Допустимое время простоя системы должно соответствовать следующим критериям:

— в день — не более 5 мин;

— в месяц — не более 3 часов.

## Основные диаграммы

### Диаграмма компонентов

![Untitled](%D0%9A%D1%83%D1%80%D1%81%D0%BE%D0%B2%D0%BE%D0%B8%CC%86%20%D0%BF%D1%80%D0%BE%D0%B5%D0%BA%D1%82%20%D0%98%D0%A1%20%D0%B1%D1%80%D0%BE%D0%BD%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F%20%D0%B0%D0%B2%D0%B8%D0%B0%D0%B1%D0%B8%D0%BB%D0%B5%D1%82%D0%BE%D0%B2%200889de6c4a304239850b39295292ae5e/Untitled%201.png)

- Код из plantUml
    
    ```
    @startuml
    
      [Mobile App] - [API Gateway] : HTTPS
      [Flights backend]
    
    database "PostgreSQL" as sql {
    }
    
    [Payment gateway] -up- [Flights backend] : HTTPS
    [Flights backend] - sql: jdbc
    [API Gateway] - [Flights backend] : HTTPS
    @enduml
    ```
    

### Контекстная диаграмма

![Untitled](%D0%9A%D1%83%D1%80%D1%81%D0%BE%D0%B2%D0%BE%D0%B8%CC%86%20%D0%BF%D1%80%D0%BE%D0%B5%D0%BA%D1%82%20%D0%98%D0%A1%20%D0%B1%D1%80%D0%BE%D0%BD%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F%20%D0%B0%D0%B2%D0%B8%D0%B0%D0%B1%D0%B8%D0%BB%D0%B5%D1%82%D0%BE%D0%B2%200889de6c4a304239850b39295292ae5e/Untitled%202.png)

### Use Case диаграмма

![Untitled](%D0%9A%D1%83%D1%80%D1%81%D0%BE%D0%B2%D0%BE%D0%B8%CC%86%20%D0%BF%D1%80%D0%BE%D0%B5%D0%BA%D1%82%20%D0%98%D0%A1%20%D0%B1%D1%80%D0%BE%D0%BD%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F%20%D0%B0%D0%B2%D0%B8%D0%B0%D0%B1%D0%B8%D0%BB%D0%B5%D1%82%D0%BE%D0%B2%200889de6c4a304239850b39295292ae5e/Untitled%203.png)

- Код из plantUml
    
    ```
    @startuml
    actor "Неавторизованный пользователь" as nu
    actor Пользователь as u
    actor "Авторизованный пользователь" as au
    
    u <|-- au
    u <|-- nu
    
    nu <|-- au
    
    package "ИС бронирования авиабилетов" {
    usecase "Получить информацию о месте прибытия" as uc1
    usecase "Получить информацию о необходимости визы" as uc2
    usecase "Получить информацию о погоде" as uc3
    usecase "Получить информацию о курсе местной валюты" as uc4
    usecase "Получить список рейсов по заданным критериям" as uc5
    usecase "Обратиться в службу поддержки" as uc6
    usecase "Оплатить билеты" as uc7
    usecase "Забронировать билеты на выбранный рейс" as uc8
    usecase "Зайти в личный кабинет" as uc9
    usecase "Посмотреть информацию о купленных билетах" as uc10
    usecase "Посмотреть уведомления в личном кабинете" as uc11
    }
    nu --> uc1
    nu --> uc5
    nu --> uc6
    nu --> uc7
    nu --> uc8
    au --> uc9
    
    uc1 --> uc2: include
    uc1 --> uc3: include
    
    uc5 <-- uc1: extend 
    
    uc1 --> uc4: include
    uc9 <-- uc10: extend
    uc9 <-- uc11: extend
    
    @enduml
    ```
    

### Sequence диаграмма бронирования авиабилетов

![Untitled](%D0%9A%D1%83%D1%80%D1%81%D0%BE%D0%B2%D0%BE%D0%B8%CC%86%20%D0%BF%D1%80%D0%BE%D0%B5%D0%BA%D1%82%20%D0%98%D0%A1%20%D0%B1%D1%80%D0%BE%D0%BD%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F%20%D0%B0%D0%B2%D0%B8%D0%B0%D0%B1%D0%B8%D0%BB%D0%B5%D1%82%D0%BE%D0%B2%200889de6c4a304239850b39295292ae5e/Untitled%204.png)

- Код из plantUml
    
    ```
    @startuml
    
    actor Пользователь as u
    participant Сайт as c
    participant "Сервис бронирования" as sb #yellow
    participant "Сервис скоринга" as ss
    participant "Сервисы авиакомпании" as sa
    
    u -> c: Ввод деталей маршрута \n(место вылета и прилета, дату)
    c -> sb: Поиск рейсов по параметрам
    sb -> sa: Поиск рейсов по параметрам в разных авиакомпаниях
    
    alt Рейсов по заданному маршруту в этот день нет
    sa --> sb: Ответ: нет рейсов
    sb --> c: Ответ: нет рейсов
    c --> u: Ответ: нет рейсов
    end
    
    sa --> sb: Список рейсов
    sb --> c: Список рейсов
    c --> u: Список рейсов
    
    u -> c: Выбор рейса
    c --> u: Детали рейса
    
    u -> c: Забронировать рейс \n(указать количество билетов)
    c -> sb: Забронировать рейс 
    sb -> ss: Проверить заказ на валидность
    ss -> ss: Проверить количество билетов
    
    alt Количество билетов > 5
    ss --> sb: Ответ: Укажите не больше 5 билетов
    sb --> c: Ответ: Укажите не больше 5 билетов
    c --> u: Ответ: Укажите не больше 5 билетов
    end
    
    ss -> sb: Ответ: Продолжайте бронирование
    sb -> sa: Проверить наличие необходимого \n количества билетов
    sa -> sa: Проверить наличие необходимого \n количества билетов
    
    alt Не осталось билетов
    sa --> sb: Ответ: Выберите меньшее количество билетов
    sb --> c: Ответ: Выберите меньшее количество билетов
    c --> u: Ответ: Выберите меньшее количество билетов
    end
    
    sa --> sb: Ответ: Билеты есть
    sb --> c: Ответ: Билеты есть
    c --> u: Ответ: Введите паспортные данные
    u -> c: Ввод паспортных данных
    c -> sb: Ввод паспортных данных
    sb -> ss: Проверить валидность паспортных данных
    
    alt Некорректная информация в паспортных данных
    ss --> sb: Ответ: ошибка в паспортных данных
    sb --> c: Ответ: ошибка в паспортных данных
    c --> u: Ответ: ошибка в паспортных данных
    end
    
    ss --> sb: Корректные паспортные данные
    sb -> sa: Забронировать билеты
    sa -> sa: Проверить актуальность информации о рейсе
    sa --> sb: Ответ: Бронь билетов на 2 часа
    sb --> c: Ответ: Бронь билетов на 2 часа 
    c --> u: Ответ: Бронь билетов на 2 часа
    
    @enduml
    ```
    

## Моделирование процессов

### Процесс поиска рейсов

![Untitled](%D0%9A%D1%83%D1%80%D1%81%D0%BE%D0%B2%D0%BE%D0%B8%CC%86%20%D0%BF%D1%80%D0%BE%D0%B5%D0%BA%D1%82%20%D0%98%D0%A1%20%D0%B1%D1%80%D0%BE%D0%BD%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F%20%D0%B0%D0%B2%D0%B8%D0%B0%D0%B1%D0%B8%D0%BB%D0%B5%D1%82%D0%BE%D0%B2%200889de6c4a304239850b39295292ae5e/Untitled%205.png)

**Описание процесса:** 
Процесс начинается с запроса пользователя, то есть когда он вводит детали маршрута (места вылета и прилета, дату). Затем система получает данный запрос и начинает подбирать подходящие рейсы. Если подходящих рейсов нет, тогда система оповещает об этом пользователя и просит пользователя изменить критерии запроса (например, дату). Если подходящие рейсы были найдены, тогда систем выдает пользователю список рейсов.

### Процесс бронирования билетов

![Untitled](%D0%9A%D1%83%D1%80%D1%81%D0%BE%D0%B2%D0%BE%D0%B8%CC%86%20%D0%BF%D1%80%D0%BE%D0%B5%D0%BA%D1%82%20%D0%98%D0%A1%20%D0%B1%D1%80%D0%BE%D0%BD%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F%20%D0%B0%D0%B2%D0%B8%D0%B0%D0%B1%D0%B8%D0%BB%D0%B5%D1%82%D0%BE%D0%B2%200889de6c4a304239850b39295292ae5e/Untitled%206.png)

**Описание процесса:**

Процесс начинается с того, что пользователь выбирает рейс и система выдает детали маршрута. Если пользователю не подходит рейс, он выбирает другой. Если ему все подходит, тогда он нажимает “Заказать” билеты и происходит расчет стоимости билета (подпроцесс). Если цена устраивает, тогда пользователь вводит паспортные данные и нажимает “Заказать”, тогда система бронирует за ним билеты на определенный промежуток времени, до оплаты. В противном случае (если цена не устроила), пользователь подбирает другие рейсы.

## Проектирование API для фронта приложения

**Объединение Use Cases по логическим группам**

![Untitled](%D0%9A%D1%83%D1%80%D1%81%D0%BE%D0%B2%D0%BE%D0%B8%CC%86%20%D0%BF%D1%80%D0%BE%D0%B5%D0%BA%D1%82%20%D0%98%D0%A1%20%D0%B1%D1%80%D0%BE%D0%BD%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F%20%D0%B0%D0%B2%D0%B8%D0%B0%D0%B1%D0%B8%D0%BB%D0%B5%D1%82%D0%BE%D0%B2%200889de6c4a304239850b39295292ae5e/Untitled%207.png)

- Код из plantUml
    
    ```
    @startuml
    actor "Неавторизованный пользователь" as nu
    actor Пользователь as u
    actor "Авторизованный пользователь" as au
    
    u <|-- au
    u <|-- nu
    
    nu <|-- au
    
    package "Экран деталей рейса" {
    usecase "Получить информацию о месте прибытия" as uc1
    usecase "Получить информацию о необходимости визы" as uc2
    usecase "Получить информацию о погоде" as uc3
    usecase "Получить информацию о курсе местной валюты" as uc4
    }
    package "Общие функции" {
    usecase "Получить список рейсов по заданным критериям" as uc5
    usecase "Обратиться в службу поддержки" as uc6
    usecase "Оплатить билеты" as uc7
    usecase "Забронировать билеты на выбранный рейс" as uc8
    }
    
    package "Экран авторизованного пользователя" {
    usecase "Зайти в личный кабинет" as uc9
    usecase "Посмотреть информацию о купленных билетах" as uc10
    usecase "Посмотреть уведомления в личном кабинете" as uc11
    }
    nu --> uc1
    nu --> uc5
    nu --> uc6
    nu --> uc7
    nu --> uc8
    au --> uc9
    
    uc1 --> uc2: include
    uc1 --> uc3: include
    
    uc5 <-- uc1: extend 
    
    uc1 --> uc4: include
    uc9 <-- uc10: extend
    uc9 <-- uc11: extend
    
    @enduml
    ```
    

**Низкодетализированные макеты экранов системы**

![Untitled](%D0%9A%D1%83%D1%80%D1%81%D0%BE%D0%B2%D0%BE%D0%B8%CC%86%20%D0%BF%D1%80%D0%BE%D0%B5%D0%BA%D1%82%20%D0%98%D0%A1%20%D0%B1%D1%80%D0%BE%D0%BD%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F%20%D0%B0%D0%B2%D0%B8%D0%B0%D0%B1%D0%B8%D0%BB%D0%B5%D1%82%D0%BE%D0%B2%200889de6c4a304239850b39295292ae5e/Untitled%208.png)

- **Спецификация в формате OpenAPI**
    
    ```json
    {
      "openapi": "3.0.1",
      "x-stoplight": {
        "id": "fwjpj6d5zbnpy"
      },
      "info": {
        "title": "Avia",
        "version": "1.0"
      },
      "servers": [
        {
          "url": "http://localhost:3000"
        }
      ],
      "paths": {
        "/flights": {
          "get": {
            "summary": "Get a list of flights",
            "tags": [],
            "responses": {
              "200": {
                "description": "OK",
                "content": {
                  "application/json": {
                    "schema": {
                      "type": "object",
                      "x-examples": {
                        "Example 1": {
                          "weather": {
                            "middle_temp": -10,
                            "will__sediments": true,
                            "flowering": "No"
                          }
                        }
                      },
                      "properties": {
                        "flights_list": {
                          "type": "array",
                          "x-stoplight": {
                            "id": "fh46c4ywmnis1"
                          },
                          "items": {
                            "$ref": "#/components/schemas/Flight",
                            "x-stoplight": {
                              "id": "8wenvq7k0iyoh"
                            }
                          }
                        },
                        "weather": {
                          "type": "object",
                          "properties": {
                            "middle_temp": {
                              "type": "integer"
                            },
                            "will__sediments": {
                              "type": "boolean"
                            },
                            "flowering": {
                              "type": "string"
                            }
                          }
                        }
                      }
                    }
                  }
                }
              },
              "404": {
                "description": "Not Found"
              }
            },
            "operationId": "get-flights",
            "x-stoplight": {
              "id": "xh943mgg3lbhi"
            },
            "parameters": [
              {
                "schema": {
                  "type": "string"
                },
                "in": "query",
                "name": "departure_city",
                "required": true
              },
              {
                "schema": {
                  "type": "string"
                },
                "in": "query",
                "name": "departure_airport"
              },
              {
                "schema": {
                  "type": "string"
                },
                "in": "query",
                "name": "departure_date"
              },
              {
                "schema": {
                  "type": "string"
                },
                "in": "query",
                "name": "arrival_city",
                "required": true
              },
              {
                "schema": {
                  "type": "string"
                },
                "in": "query",
                "name": "arrival_airport"
              },
              {
                "schema": {
                  "type": "string"
                },
                "in": "query",
                "name": "arrival_date"
              },
    					{
                "schema": {
                  "type": "string"
                },
                "in": "query",
                "name": "limit"
              },
              {
                "schema": {
                  "type": "string"
                },
                "in": "query",
                "name": "offset"
              }
            ]
          }
        },
        "/flights/{flight_id}": {
          "parameters": [
            {
              "schema": {
                "type": "string"
              },
              "name": "flight_id",
              "in": "path",
              "required": true
            }
          ],
          "get": {
            "summary": "Get flight details",
            "tags": [],
            "responses": {
              "200": {
                "description": "OK",
                "content": {
                  "application/json": {
                    "schema": {
                      "type": "object",
                      "x-examples": {
                        "Example 1": {
                          "route": "Санкт-Петербург - Москва",
                          "departure_time": "2023-12-04T20:00GMT+03:00",
                          "arrival_time": "2023-12-04T21:00GMT+03:00",
                          "price": 5200,
                          "is_visa_needed": true,
                          "currency": "$",
                          "exchange_rate": 92.1
                        }
                      },
                      "properties": {
                        "route": {
                          "type": "string"
                        },
                        "departure_airoport": {
                          "$ref": "#/components/schemas/Airoport",
                          "x-stoplight": {
                            "id": "uwvwz4faf7whz"
                          }
                        },
                        "departure_time": {
                          "type": "string"
                        },
                        "arrival_airoport": {
                          "$ref": "#/components/schemas/Airoport",
                          "x-stoplight": {
                            "id": "7k2x6iucgjlr4"
                          }
                        },
                        "arrival_time": {
                          "type": "string"
                        },
                        "price": {
                          "type": "integer"
                        },
                        "is_visa_needed": {
                          "type": "boolean"
                        },
                        "currency": {
                          "type": "string"
                        },
                        "exchange_rate": {
                          "type": "number"
                        }
                      }
                    }
                  }
                }
              },
              "404": {
                "description": "Not Found"
              }
            },
            "operationId": "get-flights-flight_id",
            "x-stoplight": {
              "id": "pk3t3r59yf6f0"
            }
          }
        },
        "/flights/{flight_id}/visa": {
          "parameters": [
            {
              "schema": {
                "type": "string"
              },
              "name": "flight_id",
              "in": "path",
              "required": true
            }
          ],
          "get": {
            "summary": "Get information about visa",
            "tags": [],
            "responses": {
              "200": {
                "description": "OK",
                "content": {
                  "application/json": {
                    "schema": {
                      "type": "object",
                      "properties": {
                        "name": {
                          "type": "string"
                        },
                        "cost": {
                          "type": "number"
                        }
                      },
                      "x-examples": {
                        "Example 1": {
                          "name": "Шенгенская виза",
                          "cost": 7928.98
                        }
                      }
                    }
                  }
                }
              },
              "404": {
                "description": "Not Found"
              }
            },
            "operationId": "get-flights-flight_id-visa",
            "x-stoplight": {
              "id": "uqjkbyfbm0ni5"
            },
            "parameters": []
          }
        }
      },
      "components": {
        "schemas": {
          "Flight": {
            "type": "object",
            "x-examples": {
              "Example 1": {
                "id": 123,
                "price": 123,
                "date": "2023-12-04T20:00GMT+03:00",
                "flight_duration": 110,
                "transfers_count": 3
              }
            },
            "properties": {
              "id": {
                "type": "integer"
              },
              "price": {
                "type": "integer"
              },
              "date": {
                "type": "string"
              },
              "flight_duration": {
                "type": "integer"
              },
              "transfers_count": {
                "type": "integer"
              },
              "airline": {
                "$ref": "#/components/schemas/Airline",
                "x-stoplight": {
                  "id": "zg5p5n6xwo465"
                }
              }
            }
          },
          "Airline": {
            "type": "object",
            "properties": {
              "id": {
                "type": "integer"
              },
              "name": {
                "type": "string"
              },
              "icon": {
                "type": "string"
              }
            },
            "x-examples": {
              "Example 1": {
                "id": 123,
                "name": "Аэрофлот",
                "icon": "L2ZsaWdodHMvMTIzL2ltYWdlcy8wMDEucG5n"
              }
            }
          },
          "Airoport": {
            "type": "object",
            "properties": {
              "id": {
                "type": "integer"
              },
              "code": {
                "type": "string"
              },
              "name": {
                "type": "string"
              },
              "city": {
                "type": "string"
              },
              "coordinates": {
                "type": "object",
                "properties": {
                  "latitude": {
                    "type": "number"
                  },
                  "longitude": {
                    "type": "number"
                  }
                }
              },
              "airoport_image": {
                "type": "string"
              }
            },
            "x-examples": {
              "Example 1": {
                "id": 123,
                "code": "LED",
                "name": "Пулково",
                "city": "Санкт-Петербург",
                "coordinates": {
                  "latitude": 59.7998,
                  "longitude": 30.273
                },
                "airoport_image": "L2ZsaWdodHMvMTIzL2ltYWdlcy8wMDEucG5n"
              }
            }
          }
        }
      }
    }
    ```
    

## Проектирование асинхронного взаимодействия

**Проектирование чата со службой поддержки**

Для реализации данного взаимодействия будет использована технология Websockets, так как подразумевается частое обновление данных.

- Описание атрибутов
    
    ```yaml
    asyncapi: 3.0.0
    info:
      title: Support chat interaction API
      version: 1.0.0
    servers:
      public:
        host: localhost:3000
        protocol: wss
    channels:
      chat_data:
        address: '/v1/chats/{chat_id}'
        messages:
          chat_data:
            $ref: '#/components/messages/chat_data'
        parameters:
          chat_id: string
        bindings:
          ws:
            bindingVersion: 0.1.0
            query:
              type: object
              properties:
                heartbeat:
                  type: boolean
                  default: false
    operations:
      sendChatData:
        action: send
        channel:
          $ref: '#/channels/chat_data'
        summary: Receive chat updates
        messages:
          - $ref: '#/channels/chat_data/messages/chat_data'
      receiveChatData:
        action: receive
        channel:
          $ref: '#/channels/chat_data'
        summary: Receive chat updates
        messages:
          - $ref: '#/channels/chat_data/messages/chat_data'
    components:
      messages:
        chat_data:
          summary: Message with marked data information.
          payload:
            $ref: '#/components/schemas/chat'
          examples:
            - name: updateMessage
              summary: >-
                Example of an update message that contains a change in price
                information.
              payload:
                type: update
                timestamp: 1619769673
                timestampms: 1619769673527
                socket_sequence: 661
                message:
                  - type: message
                    text: Hello world
                    sender: Support
                    send_date: 123456789
            - name: heartbeatMessage
              summary: Example of additional heartbeat message when you enable them.
              payload:
                type: heartbeat
                socket_sequence: 1656
      schemas:
        chat:
          type: object
          oneOf:
            - $ref: '#/components/schemas/heartbeat'
            - $ref: '#/components/schemas/update'
        heartbeat:
          allOf:
            - properties:
                type:
                  type: string
                  const: heartbeat
              required:
                - type
            - $ref: '#/components/schemas/default'
        update:
          allOf:
            - properties:
                type:
                  type: string
                  const: update
                message:
                  $ref: '#/components/schemas/message'
              required:
                - type
                - eventId
                - message
                - timestamp
                - timestampms
            - $ref: '#/components/schemas/default'
        default:
          type: object
          required:
            - type
            - socket_sequence
          properties:
            socket_sequence:
              type: integer
        message:
          type: array
          items:
            type: object
            additionalProperties: false
            properties:
              type:
                type: string
                enum:
                  - message
                  - chat_event
              text:
                type: string
              sender:
                type: string
              send_date:
                type: integer
    ```
    

## Проектирование предметной области

### Основные сущности и связи

![Untitled](%D0%9A%D1%83%D1%80%D1%81%D0%BE%D0%B2%D0%BE%D0%B8%CC%86%20%D0%BF%D1%80%D0%BE%D0%B5%D0%BA%D1%82%20%D0%98%D0%A1%20%D0%B1%D1%80%D0%BE%D0%BD%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F%20%D0%B0%D0%B2%D0%B8%D0%B0%D0%B1%D0%B8%D0%BB%D0%B5%D1%82%D0%BE%D0%B2%200889de6c4a304239850b39295292ae5e/Untitled.jpeg)

### Концептуальная модель

![Untitled](%D0%9A%D1%83%D1%80%D1%81%D0%BE%D0%B2%D0%BE%D0%B8%CC%86%20%D0%BF%D1%80%D0%BE%D0%B5%D0%BA%D1%82%20%D0%98%D0%A1%20%D0%B1%D1%80%D0%BE%D0%BD%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F%20%D0%B0%D0%B2%D0%B8%D0%B0%D0%B1%D0%B8%D0%BB%D0%B5%D1%82%D0%BE%D0%B2%200889de6c4a304239850b39295292ae5e/Untitled%201.jpeg)

### Описание основных атрибутов и ключей

![Untitled](%D0%9A%D1%83%D1%80%D1%81%D0%BE%D0%B2%D0%BE%D0%B8%CC%86%20%D0%BF%D1%80%D0%BE%D0%B5%D0%BA%D1%82%20%D0%98%D0%A1%20%D0%B1%D1%80%D0%BE%D0%BD%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F%20%D0%B0%D0%B2%D0%B8%D0%B0%D0%B1%D0%B8%D0%BB%D0%B5%D1%82%D0%BE%D0%B2%200889de6c4a304239850b39295292ae5e/Untitled%209.png)

### Логическая модель

![Untitled](%D0%9A%D1%83%D1%80%D1%81%D0%BE%D0%B2%D0%BE%D0%B8%CC%86%20%D0%BF%D1%80%D0%BE%D0%B5%D0%BA%D1%82%20%D0%98%D0%A1%20%D0%B1%D1%80%D0%BE%D0%BD%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F%20%D0%B0%D0%B2%D0%B8%D0%B0%D0%B1%D0%B8%D0%BB%D0%B5%D1%82%D0%BE%D0%B2%200889de6c4a304239850b39295292ae5e/Untitled%202.jpeg)

### Физическая модель

![Untitled](%D0%9A%D1%83%D1%80%D1%81%D0%BE%D0%B2%D0%BE%D0%B8%CC%86%20%D0%BF%D1%80%D0%BE%D0%B5%D0%BA%D1%82%20%D0%98%D0%A1%20%D0%B1%D1%80%D0%BE%D0%BD%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F%20%D0%B0%D0%B2%D0%B8%D0%B0%D0%B1%D0%B8%D0%BB%D0%B5%D1%82%D0%BE%D0%B2%200889de6c4a304239850b39295292ae5e/Untitled%203.jpeg)

## Примеры SQL-запросов

- Код SQL-запросов
    
    ```sql
    -- Создание таблиц
    
    CREATE TABLE public."Airline"
    (
        id serial NOT NULL,
        name varchar NOT NULL,
        logo_url varchar,
        website_url varchar,
        PRIMARY KEY (id)
    );
    
    CREATE TABLE public."Airport"
    (
        id serial NOT NULL,
        name varchar NOT NULL,
        code varchar NOT NULL,
        city varchar NOT NULL,
        latitude double precision NOT NULL,
        longitude double precision NOT NULL,
    	image_url varchar,
        PRIMARY KEY (id)
    );
    
    CREATE TABLE public."Flight"
    (
        id serial NOT NULL,
        airport_from_id integer NOT NULL,
    	airport_to_id integer NOT NULL,
    	airline_id integer NOT NULL,
        departure_date timestamp with time zone NOT NULL,
    	arrival_date timestamp with time zone NOT NULL,
    	price double precision NOT NULL,
    	plane_model varchar,
    	baggage boolean NOT NULL,
        PRIMARY KEY (id),
    	FOREIGN KEY (airport_from_id) REFERENCES public."Airport" (id),
    	FOREIGN KEY (airport_to_id) REFERENCES public."Airport" (id),
    	FOREIGN KEY (airline_id) REFERENCES public."Airline" (id)
    );
    
    CREATE TABLE public."User"
    (
        id serial NOT NULL,
        second_name varchar NOT NULL,
        first_name varchar NOT NULL,
        middle_name varchar,
        sex varchar,
        birday_date timestamp with time zone,
        PRIMARY KEY (id)
    );
    
    CREATE TABLE public."User Documents"
    (
        id serial NOT NULL,
        user_id integer NOT NULL,
        document_type varchar NOT NULL,
        serial_number bigint NOT NULL,
        issue_date timestamp with time zone NOT NULL,
    	authority varchar,
        PRIMARY KEY (id),
        FOREIGN KEY (user_id) REFERENCES public."User" (id)
    );
    
    CREATE TABLE public."User Contacts"
    (
        user_id integer NOT NULL,
        phone_number varchar NOT NULL,
    	email varchar NOT NULL,
        FOREIGN KEY (user_id) REFERENCES public."User" (id)
    );
    
    CREATE TABLE public."Flight Registration"
    (
        id serial NOT NULL,
        user_id integer NOT NULL,
        flight_id integer NOT NULL,
        baggage_bought boolean NOT NULL,
        PRIMARY KEY (id),
        FOREIGN KEY (user_id) REFERENCES public."User" (id),
        FOREIGN KEY (flight_id) REFERENCES public."Flight" (id)
    );
    
    -- Наполнение данными
    
    INSERT INTO public."Airline"(
    	name, logo_url, website_url)
    	VALUES ('Aeroflot', 'https://1000logos.net/wp-content/uploads/2020/02/Aeroflot-Logo.png', 'https://www.aeroflot.ru');
    
    INSERT INTO public."Airport"(
    	name, code, city, latitude, longitude)
    	VALUES ('Пулково', 'LED', 'Санкт-Петербург', 59.800163466, 30.25749897),
               ('Шереметьево', 'SVO', 'Москва', 55.970329452, 37.408831698),
               ('Стамбул Новый аэропорт', 'IST', 'Стамбул', 55.9722629452, 38.408831698);
     
    INSERT INTO public."Flight"(
    	airport_from_id, airport_to_id, airline_id, departure_date, arrival_date, price, plane_model, baggage)
    	VALUES (1, 2, 1, '2023-12-25 12:00:00Z', '2023-12-25 15:00:00Z', 4500.0, 'Boeing 737',  true),
               (1, 2, 1, '2023-12-25 15:00:00Z', '2023-12-25 18:00:00Z', 2500.0, 'Boeing 737',  true),
               (2, 3, 1, '2023-12-25 17:00:00Z', '2023-12-25 22:00:00Z', 5300.0, 'Boeing 737',  true);
    
    INSERT INTO public."User"(
    	second_name, first_name, middle_name, sex, birday_date)
    	VALUES ('Иванов', 'Влад', 'Арнольдович', 'М', '2000-01-22 00:00:00Z'),
               ('Петров', 'Василий', 'Ануфревич', 'М', '1996-06-29 00:00:00Z'),
               ('Воеводский', 'Александр', 'Максимович', 'М', '2001-03-01 00:00:00Z'),
               ('Неополитанская', 'Мария', 'Игоревна', 'Ж', '1975-02-18 00:00:00Z'),
               ('Музыченко', 'Алла', 'Борисовна', 'Ж', '2003-10-27 00:00:00Z');
    
    INSERT INTO public."User Contacts"(
    	user_id, phone_number, email)
    	VALUES ('1', '+79119574675', 'ivan@mail.ru'),
               ('2', '+79115564875', 'vasya@mail.ru'),
               ('3', '+79219564833', 'voevoda@gmail.com'),
               ('4', '+79113456345', 'neapol@mail.ru'),
               ('5', '+79217593659', 'musico@gmail.ru');
    
    INSERT INTO public."User Documents"(
    	user_id, document_type, serial_number, issue_date, authority)
    	VALUES ('1', 'Паспорт', 4015202625, '2020-10-10 00:00:00Z', 'МВД города Улан-Удэ'),
               ('2', 'Паспорт', 754566787, '2021-11-10 00:00:00Z', 'ФМС 78420'),
               ('3', 'Паспорт', 778747654, '2023-07-20 00:00:00Z', 'ФМС'),
               ('4', 'Паспорт', 4020464835, '2023-12-30 00:00:00Z', 'МВД города Урюпинск'),
               ('5', 'Паспорт', 754565797, '2019-05-17 00:00:00Z', 'ФМС 73948');
    
    INSERT INTO public."Flight Registration"(
    	user_id, flight_id, baggage_bought)
    	VALUES (1, 1, true),
               (2, 1, false),
               (3, 1, false),
               (4, 2, true),
               (5, 2, true);
    
    -- Сбор необходимой информации о рейсе
    select 
     flight.id,
     flight.departure_date,
     flight.arrival_date,
     flight.price,
     flight.plane_model,
     flight.baggage,
     flight.airport_from_id,
     from_airport.name as from_airport_name,
     from_airport.code as from_airport_code,
     from_airport.city as from_airport_city,
     flight.airport_to_id,
     to_airport.name as to_airport_name,
     to_airport.code as to_airport_code,
     to_airport.city as to_airport_city,
     airline.name as airline_name
     
    from public."Flight" flight
    
    JOIN public."Airport" from_airport 
    ON from_airport.id=flight.airport_from_id
    
    JOIN public."Airport" to_airport 
    ON to_airport.id=flight.airport_to_id
    
    JOIN public."Airline" airline 
    ON airline.id=flight.airline_id;
    
    -- Получения адресов почты пользователей
    select "User".second_name, "User".first_name, "User Contacts".email from public."User"
    JOIN public."User Contacts" ON "User".id="User Contacts".user_id;
    
    -- Получение регистраций на рейсы
    select * from public."Flight Registration"
    left join public."Flight" on "Flight".id="Flight Registration".flight_id;
    
    -- Получение количества зарегистрированных на рейс пассажиров агрегатной функцией
    select flight_id, count(user_id) as user_count from public."Flight Registration"
    group by flight_id
    order by user_count DESC;
    
    -- Получение перелётов с ценой больше средней для указанного направления (из А в В) 
    SELECT "Flight".id, "Flight".departure_date, "Flight".arrival_date, "Flight".price, "Flight".airline_id, "Airline".name FROM public."Flight"
    JOIN public."Airline" ON "Airline".id="Flight".airline_id
    WHERE airport_from_id=1 AND airport_to_id=2 AND price > (SELECT AVG(price) FROM public."Flight");
    
    -- Обновление адреса почты пользователя
    UPDATE public."User Contacts"
    	SET email='newemail@magicmail.com'
    	WHERE user_id=2;
    
    -- Обновление времени вылета, прилета и цены рейса 
    UPDATE public."Flight"
    	SET departure_date='2023-12-25 15:00:00Z' , arrival_date='2023-12-25 18:00:00Z', price=4000
    	WHERE id=1;
    
    -- Удаления пользователя из регистрации на рейс в связи с отменой бронирования
    DELETE FROM public."Flight Registration"
    	WHERE user_id=5 and flight_id=3;
    ```
    

## Визуализация пути пользователя

![IMG_0258.jpeg](%D0%9A%D1%83%D1%80%D1%81%D0%BE%D0%B2%D0%BE%D0%B8%CC%86%20%D0%BF%D1%80%D0%BE%D0%B5%D0%BA%D1%82%20%D0%98%D0%A1%20%D0%B1%D1%80%D0%BE%D0%BD%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F%20%D0%B0%D0%B2%D0%B8%D0%B0%D0%B1%D0%B8%D0%BB%D0%B5%D1%82%D0%BE%D0%B2%200889de6c4a304239850b39295292ae5e/IMG_0258.jpeg)

## Дальнешее развитие проекта

В планах развить платформу как минимум в четырех направлениях: 

1. сделать её максимально полезной для аллергиков, например, подключившись к сервисам прогнозов цветения;
2. разработать удобный личный кабинет, учитывающий ряд особенностей пользователя (ограничения по здоровью, предпочитаемые авиакомпании и класс, способ оплаты);
3. добавить дополнительные услуги по визам и страховкам (сотрудничество с организациями, оформляющими визц и страховки);
4. включить в систему новостные ленты со свежей информацией в месте назначения.